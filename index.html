<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOKYO IDOL FESTIVAL 2025 マイタイムテーブル</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for smoother transitions if needed, though Tailwind covers most */
        .transition-all {
            transition-property: all;
            transition-duration: 300ms;
            transition-timing-function: ease-in-out;
        }
    </style>
    <!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAk6l2j1xzLtfNpOynZwYwsMNGPbNr-oyQ",
    authDomain: "tif2025mytimetable.firebaseapp.com",
    projectId: "tif2025mytimetable",
    storageBucket:  "tif2025mytimetable.firebasestorage.app",
    messagingSenderId: "955994270731",
    appId: "1:955994270731:web:a40fd6e0387b5e02f16b0e"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore(app);
</script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 p-4 sm:p-6 lg:p-8">
    <!-- Firebase設定を定義するスクリプトブロック (Canvas環境で提供されない場合) -->
    <script>
        // Canvas環境で__firebase_configが定義されていない場合に備えて、
        // ユーザーが提供した設定をここに直接定義します。
        // 実際のデプロイ時には、これらの値はFirebaseプロジェクトのものに置き換える必要があります。
        const __firebase_config = JSON.stringify({
            apiKey: "AIzaSyAk6l2j1xzLtfNpOynZwYwsMNGPbNr-oyQ", // あなたのFirebaseプロジェクトのAPIキー
            authDomain: "tif2025mytimetable.firebaseapp.com", // あなたのFirebaseプロジェクトのAuth Domain
            projectId: "tif2025mytimetable", // あなたのFirebaseプロジェクトID
            storageBucket: "tif2025mytimetable.firebasestorage.app", // あなたのFirebaseプロジェクトのStorage Bucket
            messagingSenderId: "955994270731", // あなたのFirebaseプロジェクトのMessaging Sender ID
            appId: "1:955994270731:web:a40fd6e0387b5e02f16b0e" // あなたのFirebaseプロジェクトのApp ID
        });

        // Canvas環境で__initial_auth_tokenが定義されていない場合に備えて、
        // 認証トークンを空文字列で初期化します。
        const __initial_auth_token = ""; // 実際の認証トークンがある場合はここに設定
    </script>

    <div id="app-root" class="max-w-7xl mx-auto">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-center mb-8 text-indigo-700 drop-shadow-md">
            TOKYO IDOL FESTIVAL 2025 マイタイムテーブル
        </h1>

        <!-- ユーザーID表示セクション (非表示に設定) -->
        <div id="user-id-display" class="bg-gray-100 text-gray-700 rounded-xl p-4 mb-8 shadow-sm border border-gray-200 text-center hidden">
            <p class="text-sm sm:text-base flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-2 text-indigo-500"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                あなたのユーザーID: <span id="current-user-id" class="font-mono text-gray-600 ml-2 break-all"></span>
            </p>
            <p class="text-xs text-gray-500 mt-1">このIDであなたのスケジュールが保存されます。</p>
        </div>

        <!-- マイタイムテーブルセクション -->
        <div class="bg-white rounded-xl p-4 sm:p-6 mb-8 shadow-lg border border-gray-200">
            <h2 class="text-3xl font-bold mb-6 text-indigo-700 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-3 text-purple-500"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                マイタイムテーブル
                <span id="firestore-loading-indicator" class="hidden animate-spin ml-3 text-purple-400">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>
                </span>
            </h2>
            <!-- マイタイムテーブルの日付フィルターボタン -->
            <div id="my-timetable-date-filter" class="flex flex-wrap justify-center gap-2 mb-4">
                <!-- ボタンはJavaScriptで動的に追加されます -->
            </div>
            <div id="my-timetable-content">
                <p class="text-lg text-gray-600 text-center py-8">
                    まだイベントが追加されていません。下のリストから追加してください！
                </p>
            </div>
        </div>

        <!-- スケジュールコード管理セクション -->
        <div class="bg-white rounded-xl p-4 sm:p-6 mb-8 shadow-lg border border-gray-200">
            <h2 class="text-3xl font-bold mb-6 text-indigo-700 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-key-round mr-3 text-orange-500"><path d="M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h3v-3h3v-3h3V3c0-.6-.4-1-1-1H2z"/><path d="M7 18v3"/><path d="M10 15v3"/><path d="M13 12v3"/><path d="M16 9v3"/></svg>
                スケジュールコード管理
            </h2>
            <div class="flex flex-col sm:flex-row gap-4 mb-4 items-center">
                <input
                    type="text"
                    id="schedule-code-input"
                    placeholder="4桁のコードを入力または生成"
                    maxlength="4"
                    class="flex-grow p-3 rounded-lg bg-gray-100 text-gray-800 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-400 transition duration-200 text-center sm:text-left"
                />
                <button
                    id="generate-code-btn"
                    class="px-5 py-3 bg-blue-500 hover:bg-blue-600 text-white rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 flex items-center justify-center w-full sm:w-auto"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-refresh-cw mr-2"><path d="M21 12a9 9 0 0 0-9-9V3a9 9 0 0 0-9 9h0a9 9 0 0 0 9 9v0a9 9 0 0 0 9-9Z"/><path d="M17 2.3l-4.3 4.3"/><path d="M6 16.2 2.3 17"/></svg>
                    新しいコードを生成
                </button>
            </div>
            <div class="flex flex-col sm:flex-row gap-4">
                <button
                    id="save-schedule-btn"
                    class="px-5 py-3 bg-green-500 hover:bg-green-600 text-white rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-400 flex items-center justify-center w-full sm:w-auto"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-save mr-2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    コードで保存
                </button>
                <button
                    id="load-schedule-btn"
                    class="px-5 py-3 bg-purple-500 hover:bg-purple-600 text-white rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-400 flex items-center justify-center w-full sm:w-auto"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-download mr-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>
                    コードで読み込む
                </button>
            </div>
            <p id="code-management-message" class="text-sm text-gray-600 mt-4 text-center"></p>
        </div>

        <!-- 検索バー -->
        <div class="bg-white rounded-xl p-4 sm:p-6 mb-8 shadow-lg border border-gray-200 flex items-center space-x-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search text-gray-600"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input
                type="text"
                id="search-input"
                placeholder="アーティスト名で検索..."
                class="flex-grow p-3 rounded-lg bg-gray-100 text-gray-800 placeholder-gray-500 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-indigo-400 transition duration-200"
            />
            <button
                id="clear-search-button"
                class="p-2 bg-gray-300 hover:bg-gray-400 text-gray-800 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 hidden"
                aria-label="検索をクリア"
            >
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
            </button>
        </div>

        <!-- 日付選択ボタン -->
        <div id="date-selection-buttons" class="bg-white rounded-xl p-4 sm:p-6 mb-8 shadow-lg border border-gray-200 flex flex-wrap justify-center gap-4">
            <!-- 日付ボタンはJavaScriptで動的に追加されます -->
        </div>

        <!-- 全フェスティバルタイムテーブルセクション -->
        <div class="bg-white rounded-xl p-4 sm:p-6 shadow-lg border border-gray-200">
            <h2 class="text-3xl font-bold mb-6 text-indigo-700 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-3 text-purple-500"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                全フェスティバルタイムテーブル
            </h2>
            <div id="full-timetable-content">
                <p class="text-lg text-gray-600 text-center py-8">
                    日付を選択してください。
                </p>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        // Firebase SDKのバージョンを12.0.0に更新
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, deleteDoc, getDoc, onSnapshot, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

        // CSVデータはここに直接埋め込みます
        const TIF_TIMETABLE_CSV = `Date,Stage,Performer,Time
8/1 Fri,UP-T HOT STAGE,Merry BAD TUNE.,10:00-10:30
8/1 Fri,UP-T HOT STAGE,INUWASI,10:40-11:10
8/1 Fri,UP-T HOT STAGE,HEROINES STAGE iLiFE! / のんふぃく！ / 夜光性アミューズ,11:20-12:00
8/1 Fri,UP-T HOT STAGE,Jams Collection,12:10-12:40
8/1 Fri,UP-T HOT STAGE,femme fatale,12:50-13:20
8/1 Fri,UP-T HOT STAGE,Devil ANTHEM.,13:30-14:00
8/1 Fri,UP-T HOT STAGE,ファントムシータ,14:10-14:40
8/1 Fri,UP-T HOT STAGE,ばってん少女隊,14:50-15:20
8/1 Fri,UP-T HOT STAGE,ukka,15:30-16:00
8/1 Fri,UP-T HOT STAGE,TEAM SHACHI,16:10-16:40
8/1 Fri,UP-T HOT STAGE,タイトル未定,16:50-17:20
8/1 Fri,UP-T HOT STAGE,SKE48,17:30-18:00
8/1 Fri,UP-T HOT STAGE,SWEET STEADY,18:10-18:40
8/1 Fri,UP-T HOT STAGE,いぎなり東北産,18:50-19:20
8/1 Fri,UP-T HOT STAGE,AKB48,19:30-20:00
8/1 Fri,UP-T HOT STAGE,超ときめき♡宣伝部,20:10-20:40
8/1 Fri,HEAT GARAGE,Tシャツ着用者限定ステージ ディアステージ DAY きゅるりんってしてみて / CYNHN / 虹のコンキスタドール,10:00-10:30
8/1 Fri,HEAT GARAGE,UtaGe!,10:45-11:10
8/1 Fri,HEAT GARAGE,Sweet Alley,11:10-11:35
8/1 Fri,HEAT GARAGE,前橋ウィッチーズ,11:35-12:00
8/1 Fri,HEAT GARAGE,AMEFURASSHI,12:15-12:40
8/1 Fri,HEAT GARAGE,@onefive,12:40-13:05
8/1 Fri,HEAT GARAGE,東京女子流,13:05-13:30
8/1 Fri,HEAT GARAGE,22/7,13:45-14:10
8/1 Fri,HEAT GARAGE,LumiUnion,14:10-14:35
8/1 Fri,HEAT GARAGE,きゅるりんってしてみて,14:35-15:00
8/1 Fri,HEAT GARAGE,Mirror,Mirror,15:00-15:25
8/1 Fri,HEAT GARAGE,fishbowl,15:40-16:05
8/1 Fri,HEAT GARAGE,僕が見たかった青空 雲組,16:05-16:30
8/1 Fri,HEAT GARAGE,僕が見たかった青空 青空組,16:30-16:55
8/1 Fri,HEAT GARAGE,AVAM,16:55-17:20
8/1 Fri,HEAT GARAGE,Rain Tree,17:35-18:00
8/1 Fri,HEAT GARAGE,芹澤 優,18:00-18:25
8/1 Fri,HEAT GARAGE,のんふぃく！,18:25-18:50
8/1 Fri,HEAT GARAGE,メインステージ争奪LIVE決勝戦 THE ENCORE / selfish / AOAO / My_Stage,19:35-20:55
8/1 Fri,SMILE GARDEN,TIF2025 グランドオープニング,09:30-09:45
8/1 Fri,SMILE GARDEN,ラフ×ラフ,09:45-10:05
8/1 Fri,SMILE GARDEN,Task have Fun,10:05-10:25
8/1 Fri,SMILE GARDEN,衛星とカラテア,10:25-10:45
8/1 Fri,SMILE GARDEN,アイドリング!!!,10:50-11:35
8/1 Fri,SMILE GARDEN,アイドルカレッジ,11:40-12:00
8/1 Fri,SMILE GARDEN,ワッツ◎さーくる,12:00-12:20
8/1 Fri,SMILE GARDEN,透色ドロップ,12:20-12:40
8/1 Fri,SMILE GARDEN,スペシャルコラボミックス AVAM / いぎなり東北産 / きゅるりんってしてみて / SWEET STEADY,12:50-13:20
8/1 Fri,SMILE GARDEN,虹のコンキスタドール,13:20-13:40
8/1 Fri,SMILE GARDEN,MyDearDarlin',13:40-14:00
8/1 Fri,SMILE GARDEN,#2i2,14:10-14:30
8/1 Fri,SMILE GARDEN,ジエメイ,14:30-14:50
8/1 Fri,SMILE GARDEN,にしたんクリニックNダンス選手権 TEAM SHACHI / fav me / ラフ×ラフ,14:50-15:10
8/1 Fri,SMILE GARDEN,ラナキュラ,15:20-15:40
8/1 Fri,SMILE GARDEN,ドラマチックレコード,15:40-16:00
8/1 Fri,SMILE GARDEN,15周年特別企画 IDOL SUMMER JAMBOREE 〜抽選コラボ DAY1〜 Jams Collection / なみだ色の消しごむ / Peel the Apple / ラフ×ラフ,16:00-16:25
8/1 Fri,SMILE GARDEN,#ババババンビ,16:35-16:55
8/1 Fri,SMILE GARDEN,わーすた,16:55-17:15
8/1 Fri,SMILE GARDEN,TEAM SHACHI リスペクトステージ TEAM SHACHI / AMEFURASSHI / いぎなり東北産 / ukka / ばってん少女隊 / LumiUnion / 超ときめき♡宣伝部 / 高萩千夏(アップアップガールズ(2)) / 安土姫華(いちごみるく色に染まりたい。) / 桜田アンナ(純情のアフィリア) / 城月菜央、涼海すう(高嶺のなでしこ) / 日浦菜緒、井上唯(HoneyDevil) / NICO(WHITE SCORPION)/佐佐木一心(fishbowl) / 天川れみ(LINKL PLANET) / 咲本美桜(Luce Twinkle Wink☆),17:15-17:45
8/1 Fri,SMILE GARDEN,NEO JAPONISM,17:55-18:15
8/1 Fri,SMILE GARDEN,THE ORCHESTRA TOKYO,18:15-18:35
8/1 Fri,SMILE GARDEN,PIGGS,18:35-18:55
8/1 Fri,SMILE GARDEN,かすみ草とステラ,19:05-19:25
8/1 Fri,SMILE GARDEN,AMEFURASSHI,19:25-19:45
8/1 Fri,SMILE GARDEN,クマリデパート,19:45-20:05
8/1 Fri,SMILE GARDEN,フィロソフィーのダンス,20:10-20:30
8/1 Fri,SMILE GARDEN,CYNHN,20:30-20:50
8/1 Fri,DOLL FACTORY,Luce Twinkle Wink☆,10:00-10:20
8/1 Fri,DOLL FACTORY,上月せれな,10:20-10:40
8/1 Fri,DOLL FACTORY,Amuse Dolce,10:40-11:00
8/1 Fri,DOLL FACTORY,いちごみるく色に染まりたい。,11:05-11:25
8/1 Fri,DOLL FACTORY,himawari(船橋),11:25-11:45
8/1 Fri,DOLL FACTORY,太陽と踊れ月夜に唄え,11:45-12:05
8/1 Fri,DOLL FACTORY,ストロボグリッター,12:10-12:30
8/1 Fri,DOLL FACTORY,LINKL PLANET,12:30-12:50
8/1 Fri,DOLL FACTORY,可憐なアイボリー,12:50-13:10
8/1 Fri,DOLL FACTORY,fishbowl,13:15-13:35
8/1 Fri,DOLL FACTORY,PIGGS,13:35-13:55
8/1 Fri,DOLL FACTORY,iON!,13:55-14:15
8/1 Fri,DOLL FACTORY,愛乙女★DOLL,14:20-14:40
8/1 Fri,DOLL FACTORY,まねきケチャ,14:40-15:00
8/1 Fri,DOLL FACTORY,Rain Tree,15:00-15:20
8/1 Fri,DOLL FACTORY,MyDearDarlin',15:25-15:45
8/1 Fri,DOLL FACTORY,山北早紀,15:45-16:05
8/1 Fri,DOLL FACTORY,fav me,16:05-16:25
8/1 Fri,DOLL FACTORY,15周年特別企画 タイムマシーン〜TIF Classic〜 アイドリング!!! / アイドルカレッジ / 純情のアフィリア / SUPER☆GiRLS / 東京女子流 / Negicco(Nao☆、Megu） / 風男塾 / LinQ,16:35-17:20
8/1 Fri,DOLL FACTORY,RAViDAVi,17:30-17:50
8/1 Fri,DOLL FACTORY,Ma'Scar'Piece,17:50-18:10
8/1 Fri,DOLL FACTORY,SITUASION,18:10-18:30
8/1 Fri,DOLL FACTORY,#Mooove!,18:35-18:55
8/1 Fri,DOLL FACTORY,SUPER☆GiRLS,18:55-19:15
8/1 Fri,DOLL FACTORY,LinQ,19:15-19:35
8/1 Fri,DOLL FACTORY,フューチャーサイダー,19:40-20:00
8/1 Fri,DOLL FACTORY,なみだ色の消しごむ,20:00-20:20
8/1 Fri,DOLL FACTORY,高嶺のなでしこ,20:20-20:40
8/1 Fri,SKY STAGE,Onephony,10:30-10:45
8/1 Fri,SKY STAGE,SCRAMBLE SMILE,10:45-11:00
8/1 Fri,SKY STAGE,MEGAFON,11:00-11:15
8/1 Fri,SKY STAGE,Honey Devil,11:15-11:30
8/1 Fri,SKY STAGE,みらくらんど,11:35-11:50
8/1 Fri,SKY STAGE,アップアップガールズ（2）,11:50-12:05
8/1 Fri,SKY STAGE,シンデレラ宣言！,12:05-12:20
8/1 Fri,SKY STAGE,#よーよーよー,12:20-12:35
8/1 Fri,SKY STAGE,ノルニル,12:40-12:55
8/1 Fri,SKY STAGE,Palette Parade,12:55-13:10
8/1 Fri,SKY STAGE,ROOKEY♡ROOKEYS,13:10-13:25
8/1 Fri,SKY STAGE,Tohkei,13:25-13:40
8/1 Fri,SKY STAGE,ネコプラpixx.,13:45-14:00
8/1 Fri,SKY STAGE,雨のち、ハレーション,14:00-14:15
8/1 Fri,SKY STAGE,ポンコツコンポ,14:15-14:30
8/1 Fri,SKY STAGE,アンスリューム,14:30-14:45
8/1 Fri,SKY STAGE,WHITE SCORPION,14:45-15:00
8/1 Fri,SKY STAGE,Luce Twinkle Wink☆,16:20-16:35
8/1 Fri,SKY STAGE,chuLa,16:35-16:50
8/1 Fri,SKY STAGE,Appare!,16:50-17:05
8/1 Fri,SKY STAGE,可憐なアイボリー,17:10-17:25
8/1 Fri,SKY STAGE,STAiNY,17:25-17:40
8/1 Fri,SKY STAGE,虹のコンキスタドール,17:40-17:55
8/1 Fri,SKY STAGE,himawari(船橋),18:00-18:15
8/1 Fri,SKY STAGE,スペシャルコラボステージ タイトル未定 / 高嶺のなでしこ,18:15-18:40
8/1 Fri,SKY STAGE,CiON,18:40-18:55
8/1 Fri,SKY STAGE,ジエメイ,19:00-19:15
8/1 Fri,SKY STAGE,Negicco（Nao☆、Megu）,19:15-19:30
8/1 Fri,SKY STAGE,ラフ×ラフ,19:30-19:45
8/1 Fri,SKY STAGE,ukka,19:50-20:05
8/1 Fri,SKY STAGE,@onefive,20:05-20:20
8/1 Fri,SKY STAGE,夜光性アミューズ,20:20-20:35
8/1 Fri,TOROCCO PARK,Appare!,10:00-10:20
8/1 Fri,TOROCCO PARK,iON!,10:20-10:40
8/1 Fri,TOROCCO PARK,シンデレラ宣言！,10:40-11:00
8/1 Fri,TOROCCO PARK,My_Stage,11:05-11:25
8/1 Fri,TOROCCO PARK,AOAO,11:25-11:45
8/1 Fri,TOROCCO PARK,FES☆TIVE,11:45-12:05
8/1 Fri,TOROCCO PARK,CiON,12:10-12:30
8/1 Fri,TOROCCO PARK,風男塾,12:30-12:50
8/1 Fri,TOROCCO PARK,NEO JAPONISM,12:50-13:10
8/1 Fri,TOROCCO PARK,THE ENCORE,13:15-13:35
8/1 Fri,TOROCCO PARK,Road to TIF 5位,13:35-13:55
8/1 Fri,TOROCCO PARK,純情のアフィリア,13:55-14:15
8/1 Fri,TOROCCO PARK,全国選抜LIVEグランプリ決定戦 ストロボグリッター / みらくらんど / éclatcia / ティラミス / ROOKEY♡ROOKEYS / メノニューイヤー,14:20-15:30
8/1 Fri,TOROCCO PARK,点染テンセイ少女。,15:35-15:55
8/1 Fri,TOROCCO PARK,RAViDAVi,15:55-16:15
8/1 Fri,TOROCCO PARK,アンスリューム,16:15-16:35
8/1 Fri,TOROCCO PARK,かすみ草とステラ,16:35-16:55
8/1 Fri,TOROCCO PARK,Ringwanderung,17:00-17:20
8/1 Fri,TOROCCO PARK,selfish,17:20-17:40
8/1 Fri,TOROCCO PARK,Peel the Apple,17:40-18:00
8/1 Fri,TOROCCO PARK,Task have Fun,18:05-18:25
8/1 Fri,TOROCCO PARK,わーすた,18:25-18:45
8/1 Fri,浮島STAGE,#2i2,10:00-10:15
8/1 Fri,浮島STAGE,éclatcia,10:15-10:30
8/1 Fri,浮島STAGE,SITUASION,10:30-10:45
8/1 Fri,浮島STAGE,AVAM,10:45-11:00
8/1 Fri,浮島STAGE,ノルニル,11:05-11:20
8/1 Fri,浮島STAGE,ティラミス,11:20-11:35
8/1 Fri,浮島STAGE,#Mooove!,11:35-11:50
8/1 Fri,浮島STAGE,愛乙女★DOLL,11:50-12:05
8/1 Fri,浮島STAGE,メノニューイヤー,12:10-12:25
8/1 Fri,浮島STAGE,雨のち、ハレーション,12:25-12:40
8/1 Fri,浮島STAGE,STAiNY,12:40-12:55
8/1 Fri,浮島STAGE,Amuse Dolce,12:55-13:10
8/1 Fri,浮島STAGE,Road to TIF 6位,13:20-13:35
8/1 Fri,浮島STAGE,いちごみるく色に染まりたい。,13:35-13:50
8/1 Fri,浮島STAGE,Honey Devil,13:50-14:05
8/1 Fri,浮島STAGE,Palette Parade,14:05-14:20
8/1 Fri,浮島STAGE,アップアップガールズ（2）,14:25-14:40
8/1 Fri,浮島STAGE,chuLa,14:40-14:55
8/1 Fri,浮島STAGE,SCRAMBLE SMILE,14:55-15:10
8/1 Fri,浮島STAGE,上月せれな,15:20-15:35
8/1 Fri,浮島STAGE,ポンコツコンポ,15:35-15:50
8/1 Fri,浮島STAGE,アイドルカレッジ,15:50-16:05
8/1 Fri,浮島STAGE,Tohkei,16:15-16:30
8/1 Fri,浮島STAGE,THE ORCHESTRA TOKYO,16:30-16:45
8/1 Fri,浮島STAGE,MEGAFON,16:55-17:10
8/1 Fri,浮島STAGE,ドラマチックレコード,17:10-17:25
8/1 Fri,浮島STAGE,Merry BAD TUNE.,17:25-17:40
8/1 Fri,浮島STAGE,UtaGe!,17:40-17:55
8/1 Fri,浮島STAGE,IDOL盆踊りナイト DAY1 Appare! / fishbowl / FES☆TIVE / 東京おとめ太鼓,18:05-18:30
8/2 Sat,UP-T HOT STAGE,私立恵比寿中学,10:00-10:30
8/2 Sat,UP-T HOT STAGE,Task have Fun,10:40-11:10
8/2 Sat,UP-T HOT STAGE,OCHA NORMA,11:20-11:50
8/2 Sat,UP-T HOT STAGE,Appare!,12:00-12:30
8/2 Sat,UP-T HOT STAGE,i☆Ris,12:40-13:10
8/2 Sat,UP-T HOT STAGE,BEYOOOOONDS,13:20-13:50
8/2 Sat,UP-T HOT STAGE,TIF2025×UNIDOLステージ いぎなり東北産,14:00-14:15
8/2 Sat,UP-T HOT STAGE,NGT48,14:25-14:55
8/2 Sat,UP-T HOT STAGE,HKT48,15:05-15:35
8/2 Sat,UP-T HOT STAGE,わーすた,15:45-16:15
8/2 Sat,UP-T HOT STAGE,NEO JAPONISM,16:25-16:55
8/2 Sat,UP-T HOT STAGE,きゅるりんってしてみて,17:05-17:35
8/2 Sat,UP-T HOT STAGE,柏木由紀,17:45-18:15
8/2 Sat,UP-T HOT STAGE,yosugala,18:25-18:55
8/2 Sat,UP-T HOT STAGE,清 竜人25,19:05-19:35
8/2 Sat,UP-T HOT STAGE,高嶺のなでしこ,19:45-20:15
8/2 Sat,UP-T HOT STAGE,虹のコンキスタドール,20:25-20:55
8/2 Sat,HEAT GARAGE,Tシャツ着用者限定ステージ RIZE＆アップダンスエンターテインメント DAY Jams Collection / FES☆TIVE / MyDearDarlin!,10:00-10:30
8/2 Sat,HEAT GARAGE,BEYOOOOONDS,10:45-11:10
8/2 Sat,HEAT GARAGE,iLiFE!,11:10-11:35
8/2 Sat,HEAT GARAGE,#ババババンビ,11:35-12:00
8/2 Sat,HEAT GARAGE,衛星とカラテア,12:15-12:40
8/2 Sat,HEAT GARAGE,ukka,12:40-13:05
8/2 Sat,HEAT GARAGE,CiON,13:05-13:30
8/2 Sat,HEAT GARAGE,SITUASION,13:45-14:10
8/2 Sat,HEAT GARAGE,カラフルスクリーム,14:10-14:35
8/2 Sat,HEAT GARAGE,MyDearDarlin',14:35-15:00
8/2 Sat,HEAT GARAGE,ゆかたアナウンスタイム,15:05-15:15
8/2 Sat,HEAT GARAGE,後藤真希デビュー25周年♡レジェンドコラボステージ,15:25-15:50
8/2 Sat,HEAT GARAGE,ウマ娘 プリティーダービー,15:50-16:15
8/2 Sat,HEAT GARAGE,いぎなり東北産,16:15-16:40
8/2 Sat,HEAT GARAGE,ジエメイ,16:55-17:20
8/2 Sat,HEAT GARAGE,GILTY x GILTY,17:20-17:45
8/2 Sat,HEAT GARAGE,CYNHN,17:45-18:10
8/2 Sat,HEAT GARAGE,Ringwanderung,18:10-18:35
8/2 Sat,HEAT GARAGE,バンドじゃないもん！MAXX NAKAYOSHI,18:50-19:15
8/2 Sat,HEAT GARAGE,NANIMONO,19:15-19:40
8/2 Sat,HEAT GARAGE,STAiNY,19:40-20:05
8/2 Sat,HEAT GARAGE,アンスリューム,20:05-20:30
8/2 Sat,SMILE GARDEN,ラジオ体操,09:45-10:00
8/2 Sat,SMILE GARDEN,fav me,10:00-10:20
8/2 Sat,SMILE GARDEN,なみだ色の消しごむ,10:20-10:40
8/2 Sat,SMILE GARDEN,AsIs,10:40-11:00
8/2 Sat,SMILE GARDEN,可憐なアイボリー,11:10-11:30
8/2 Sat,SMILE GARDEN,Rain Tree,11:30-11:50
8/2 Sat,SMILE GARDEN,SUPER☆GiRLS,11:50-12:10
8/2 Sat,SMILE GARDEN,name:CMH,12:20-12:30
8/2 Sat,SMILE GARDEN,全国選抜LIVEグランプリステージ,12:30-12:45
8/2 Sat,SMILE GARDEN,LinQ,12:45-13:05
8/2 Sat,SMILE GARDEN,#Mooove!,13:05-13:25
8/2 Sat,SMILE GARDEN,TIF de Debut,13:35-13:50
8/2 Sat,SMILE GARDEN,スペシャルコラボステージ UtaGe! / NANIMONO,13:50-14:15
8/2 Sat,SMILE GARDEN,夜光性アミューズ,14:15-14:35
8/2 Sat,SMILE GARDEN,にしたんクリニックNダンス選手権 Appare! / #Mooove! / 二丁目の魁カミングアウト,14:45-15:05
8/2 Sat,SMILE GARDEN,iLiFE!,15:05-15:25
8/2 Sat,SMILE GARDEN,FES☆TIVE,15:25-15:45
8/2 Sat,SMILE GARDEN,Kolokol,15:55-16:15
8/2 Sat,SMILE GARDEN,fishbowl,16:15-16:35
8/2 Sat,SMILE GARDEN,Palette Parade,16:35-16:55
8/2 Sat,SMILE GARDEN,前橋ウィッチーズ,17:05-17:25
8/2 Sat,SMILE GARDEN,OCHA NORMA,17:25-17:45
8/2 Sat,SMILE GARDEN,タイトル未定,17:45-18:05
8/2 Sat,SMILE GARDEN,Devil ANTHEM.,18:15-18:35
8/2 Sat,SMILE GARDEN,Jams Collection,18:35-18:55
8/2 Sat,SMILE GARDEN,CYBERJAPAN DANCERS,18:55-19:15
8/2 Sat,SMILE GARDEN,All Live! IDOL SUMMER JAMBOREE ACOUSTIC ＆ ROCK ぁぃぁぃ(Maison de Queen) / 葵うた(Palette Parade) / 綾瀬志希(CYNHN) / 栞音(CiON) / 結城りな(ukka) / キララ(feelNEO) / 空詩かれん(iLiFE!) / 滝沢ひなの(NEO JAPONISM) / 冨樫優花(タイトル未定) / 眠目り汰(ジエメイ) / Appare! / いぎなり東北産 / CiON / NEO JAPONISM,19:40-20:40
8/2 Sat,DOLL FACTORY,ideal peco,10:00-10:20
8/2 Sat,DOLL FACTORY,#よーよーよー,10:20-10:40
8/2 Sat,DOLL FACTORY,マジカル・パンチライン,10:40-11:00
8/2 Sat,DOLL FACTORY,ティラミス,11:05-11:25
8/2 Sat,DOLL FACTORY,ルージュブック,11:25-11:45
8/2 Sat,DOLL FACTORY,ドレスコード,11:45-12:05
8/2 Sat,DOLL FACTORY,KRD8,12:10-12:30
8/2 Sat,DOLL FACTORY,#2i2,12:30-12:50
8/2 Sat,DOLL FACTORY,Maison de Queen,12:50-13:10
8/2 Sat,DOLL FACTORY,PRSMIN,13:15-13:35
8/2 Sat,DOLL FACTORY,SUPER JYAPON,13:35-13:55
8/2 Sat,DOLL FACTORY,アイテムはてるてるのみ,13:55-14:15
8/2 Sat,DOLL FACTORY,Root mimi,14:25-14:45
8/2 Sat,DOLL FACTORY,my fav,14:45-15:05
8/2 Sat,DOLL FACTORY,WHITE SCORPION,15:05-15:25
8/2 Sat,DOLL FACTORY,feelNEO,15:30-15:50
8/2 Sat,DOLL FACTORY,amini,15:50-16:10
8/2 Sat,DOLL FACTORY,のんふぃく！,16:10-16:30
8/2 Sat,DOLL FACTORY,éclatcia,16:40-17:00
8/2 Sat,DOLL FACTORY,Quubi,17:00-17:20
8/2 Sat,DOLL FACTORY,THE ORCHESTRA TOKYO,17:20-17:40
8/2 Sat,DOLL FACTORY,zanka,17:45-18:05
8/2 Sat,DOLL FACTORY,Sweet Alley,18:05-18:25
8/2 Sat,DOLL FACTORY,INUWASI,18:25-18:45
8/2 Sat,DOLL FACTORY,Toi Toi Toi,18:50-19:10
8/2 Sat,DOLL FACTORY,MAGICAL SPEC,19:10-19:30
8/2 Sat,DOLL FACTORY,君に、胸キュン。,19:30-19:50
8/2 Sat,DOLL FACTORY,FES☆TIVE,19:55-20:15
8/2 Sat,DOLL FACTORY,クマリデパート,20:15-20:35
8/2 Sat,DOLL FACTORY,ラフ×ラフ,20:35-20:55
8/2 Sat,SKY STAGE,Root mimi,10:15-10:30
8/2 Sat,SKY STAGE,W.ダブルヴィー,10:30-10:45
8/2 Sat,SKY STAGE,君に、胸キュン。,10:45-11:00
8/2 Sat,SKY STAGE,メノニューイヤー,11:00-11:15
8/2 Sat,SKY STAGE,ワッツ◎さーくる,11:20-11:35
8/2 Sat,SKY STAGE,Toi Toi Toi,11:35-11:50
8/2 Sat,SKY STAGE,群青の世界,11:50-12:05
8/2 Sat,SKY STAGE,いぎなり東北産,12:05-12:20
8/2 Sat,SKY STAGE,Road to TIF 3位,12:25-12:40
8/2 Sat,SKY STAGE,TEAR DROP!,12:40-12:55
8/2 Sat,SKY STAGE,あまいものつめあわせ,12:55-13:10
8/2 Sat,SKY STAGE,のんふぃく！,13:10-13:25
8/2 Sat,SKY STAGE,前橋ウィッチーズ,13:30-13:45
8/2 Sat,SKY STAGE,MAGICAL SPEC,13:45-14:00
8/2 Sat,SKY STAGE,タイトル未定,14:00-14:15
8/2 Sat,SKY STAGE,Ringwanderung,14:15-14:30
8/2 Sat,SKY STAGE,INUWASI,15:30-15:45
8/2 Sat,SKY STAGE,zanka,15:45-16:00
8/2 Sat,SKY STAGE,さとりモンスター,16:00-16:15
8/2 Sat,SKY STAGE,なみだ色の消しごむ,16:15-16:30
8/2 Sat,SKY STAGE,シャニムニ=パレード,16:35-16:50
8/2 Sat,SKY STAGE,ANA®KIE,16:50-17:05
8/2 Sat,SKY STAGE,ドレスコード,17:05-17:20
8/2 Sat,SKY STAGE,ideal peco,17:20-17:35
8/2 Sat,SKY STAGE,AsIs,17:40-17:55
8/2 Sat,SKY STAGE,amini,17:55-18:10
8/2 Sat,SKY STAGE,キングサリ,18:10-18:25
8/2 Sat,SKY STAGE,Maison de Queen,18:25-18:40
8/2 Sat,SKY STAGE,LinQ,18:45-19:00
8/2 Sat,SKY STAGE,衛星とカラテア,19:00-19:15
8/2 Sat,SKY STAGE,ドラマチックレコード,19:15-19:30
8/3 Sun,UP-T HOT STAGE,ロージークロニクル,10:00-10:30
8/3 Sun,UP-T HOT STAGE,DIALOGUE＋,10:40-11:10
8/3 Sun,UP-T HOT STAGE,REIRIE,11:20-11:50
8/3 Sun,UP-T HOT STAGE,ExWHYZ,12:00-12:30
8/3 Sun,UP-T HOT STAGE,NMB48,12:40-13:10
8/3 Sun,UP-T HOT STAGE,メインステージ争奪LIVE WINNERステージ,13:20-13:40
8/3 Sun,UP-T HOT STAGE,CANDY TUNE,13:50-14:20
8/3 Sun,UP-T HOT STAGE,STU48,14:30-15:00
8/3 Sun,UP-T HOT STAGE,CUTIE STREET,15:10-15:40
8/3 Sun,UP-T HOT STAGE,つばきファクトリー,15:50-16:20
8/3 Sun,UP-T HOT STAGE,Juice=Juice,16:30-17:00
8/3 Sun,UP-T HOT STAGE,iLiFE!,17:10-17:40
8/3 Sun,UP-T HOT STAGE,≒JOY,17:50-18:20
8/3 Sun,UP-T HOT STAGE,≠ME,18:30-19:00
8/3 Sun,UP-T HOT STAGE,＝LOVE,19:10-19:45
8/3 Sun,UP-T HOT STAGE,グランドフィナーレ 15th Anniversary,19:55-20:45
8/3 Sun,HEAT GARAGE,Tシャツ着用者限定ステージ PLAYYTE DAY Appare! / UtaGe! / Palette Parade,10:00-10:30
8/3 Sun,HEAT GARAGE,i-COL,10:45-11:10
8/3 Sun,HEAT GARAGE,ラフ×ラフ,11:10-11:35
8/3 Sun,HEAT GARAGE,FES☆TIVE,11:35-12:00
8/3 Sun,HEAT GARAGE,シンデレラ宣言！,12:10-12:35
8/3 Sun,HEAT GARAGE,夜光性アミューズ,12:35-13:00
8/3 Sun,HEAT GARAGE,つばきファクトリー,13:00-13:25
8/3 Sun,HEAT GARAGE,Lolly Talk,13:25-13:50
8/3 Sun,HEAT GARAGE,WACK presents DREAMLIGHTS in TIF 〜もう聴けない！WACK名曲コレクション！〜,14:00-14:45
8/3 Sun,HEAT GARAGE,Road to TIF 1位,14:55-15:10
8/3 Sun,HEAT GARAGE,TIF ASIA TOUR 2025 スペシャルライブステージ IHOTEU(ソウル) / StarWink(上海) / Primulav(台北) / モノクローム(香港) / Lolly Talk(香港),15:10-16:10
8/3 Sun,HEAT GARAGE,Onephony,16:25-16:50
8/3 Sun,HEAT GARAGE,#2i2,16:50-17:15
8/3 Sun,HEAT GARAGE,GANG PARADE,17:15-17:40
8/3 Sun,HEAT GARAGE,PIGGS,17:40-18:05
8/3 Sun,HEAT GARAGE,なみだ色の消しごむ,18:15-18:40
8/3 Sun,HEAT GARAGE,THE ORCHESTRA TOKYO,18:40-19:05
8/3 Sun,HEAT GARAGE,SWEET STEADY,19:05-19:30
8/3 Sun,HEAT GARAGE,かすみ草とステラ,19:45-20:10
8/3 Sun,HEAT GARAGE,Juice=Juice,20:10-20:35
8/3 Sun,HEAT GARAGE,ドラマチックレコード,20:35-21:00
8/3 Sun,SMILE GARDEN,ラジオ体操,09:25-09:40
8/3 Sun,SMILE GARDEN,fav me,10:00-10:20
8/3 Sun,SMILE GARDEN,なみだ色の消しごむ,10:20-10:40
8/3 Sun,SMILE GARDEN,AsIs,10:40-11:00
8/3 Sun,SMILE GARDEN,可憐なアイボリー,11:10-11:30
8/3 Sun,SMILE GARDEN,Rain Tree,11:30-11:50
8/3 Sun,SMILE GARDEN,SUPER☆GiRLS,11:50-12:10
8/3 Sun,SMILE GARDEN,name:CMH,12:20-12:30
8/3 Sun,SMILE GARDEN,全国選抜LIVEグランプリステージ,12:30-12:45
8/3 Sun,SMILE GARDEN,LinQ,12:45-13:05
8/3 Sun,SMILE GARDEN,#Mooove!,13:05-13:25
8/3 Sun,SMILE GARDEN,TIF de Debut,13:35-13:50
8/3 Sun,SMILE GARDEN,スペシャルコラボステージ,13:50-14:15
8/3 Sun,SMILE GARDEN,夜光性アミューズ,14:15-14:35
8/3 Sun,SMILE GARDEN,にしたんクリニックNダンス選手権,14:45-15:05
8/3 Sun,SMILE GARDEN,iLiFE!,15:05-15:25
8/3 Sun,SMILE GARDEN,FES☆TIVE,15:25-15:45
8/3 Sun,SMILE GARDEN,Kolokol,15:55-16:15
8/3 Sun,SMILE GARDEN,fishbowl,16:15-16:35
8/3 Sun,SMILE GARDEN,Palette Parade,16:35-16:55
8/3 Sun,SMILE GARDEN,前橋ウィッチーズ,17:05-17:25
8/3 Sun,SMILE GARDEN,OCHA NORMA,17:25-17:45
8/3 Sun,SMILE GARDEN,タイトル未定,17:45-18:05
8/3 Sun,SMILE GARDEN,Devil ANTHEM.,18:15-18:35
8/3 Sun,SMILE GARDEN,Jams Collection,18:35-18:55
8/3 Sun,SMILE GARDEN,CYBERJAPAN DANCERS,18:55-19:15
8/3 Sun,SMILE GARDEN,All Live! IDOL SUMMER JAMBOREE ACOUSTIC ＆ ROCK,19:40-20:40
8/3 Sun,DOLL FACTORY,ideal peco,10:00-10:20
8/3 Sun,DOLL FACTORY,#よーよーよー,10:20-10:40
8/3 Sun,DOLL FACTORY,マジカル・パンチライン,10:40-11:00
8/3 Sun,DOLL FACTORY,ティラミス,11:05-11:25
8/3 Sun,DOLL FACTORY,ルージュブック,11:25-11:45
8/3 Sun,DOLL FACTORY,ドレスコード,11:45-12:05
8/3 Sun,DOLL FACTORY,KRD8,12:10-12:30
8/3 Sun,DOLL FACTORY,#2i2,12:30-12:50
8/3 Sun,DOLL FACTORY,Maison de Queen,12:50-13:10
8/3 Sun,DOLL FACTORY,PRSMIN,13:15-13:35
8/3 Sun,DOLL FACTORY,SUPER JYAPON,13:35-13:55
8/3 Sun,DOLL FACTORY,アイテムはてるてるのみ,13:55-14:15
8/3 Sun,DOLL FACTORY,Root mimi,14:25-14:45
8/3 Sun,DOLL FACTORY,my fav,14:45-15:05
8/3 Sun,DOLL FACTORY,WHITE SCORPION,15:05-15:25
8/3 Sun,DOLL FACTORY,feelNEO,15:30-15:50
8/3 Sun,DOLL FACTORY,amini,15:50-16:10
8/3 Sun,DOLL FACTORY,のんふぃく！,16:10-16:30
8/3 Sun,DOLL FACTORY,éclatcia,16:40-17:00
8/3 Sun,DOLL FACTORY,Quubi,17:00-17:20
8/3 Sun,DOLL FACTORY,THE ORCHESTRA TOKYO,17:20-17:40
8/3 Sun,DOLL FACTORY,zanka,17:45-18:05
8/3 Sun,DOLL FACTORY,Sweet Alley,18:05-18:25
8/3 Sun,DOLL FACTORY,INUWASI,18:25-18:45
8/3 Sun,DOLL FACTORY,Toi Toi Toi,18:50-19:10
8/3 Sun,DOLL FACTORY,MAGICAL SPEC,19:10-19:30
8/3 Sun,DOLL FACTORY,君に、胸キュン。,19:30-19:50
8/3 Sun,DOLL FACTORY,FES☆TIVE,19:55-20:15
8/3 Sun,DOLL FACTORY,クマリデパート,20:15-20:35
8/3 Sun,DOLL FACTORY,ラフ×ラフ,20:35-20:55
8/3 Sun,SKY STAGE,Root mimi,10:15-10:30
8/3 Sun,SKY STAGE,W.ダブルヴィー,10:30-10:45
8/3 Sun,SKY STAGE,君に、胸キュン。,10:45-11:00
8/3 Sun,SKY STAGE,メノニューイヤー,11:00-11:15
8/3 Sun,SKY STAGE,ワッツ◎さーくる,11:20-11:35
8/3 Sun,SKY STAGE,Toi Toi Toi,11:35-11:50
8/3 Sun,SKY STAGE,群青の世界,11:50-12:05
8/3 Sun,SKY STAGE,いぎなり東北産,12:05-12:20
8/3 Sun,SKY STAGE,Road to TIF 3位,12:25-12:40
8/3 Sun,SKY STAGE,TEAR DROP!,12:40-12:55
8/3 Sun,SKY STAGE,あまいものつめあわせ,12:55-13:10
8/3 Sun,SKY STAGE,のんふぃく！,13:10-13:25
8/3 Sun,SKY STAGE,前橋ウィッチーズ,13:30-13:45
8/3 Sun,SKY STAGE,MAGICAL SPEC,13:45-14:00
8/3 Sun,SKY STAGE,タイトル未定,14:00-14:15
8/3 Sun,SKY STAGE,Ringwanderung,14:15-14:30
8/3 Sun,SKY STAGE,INUWASI,15:30-15:45
8/3 Sun,SKY STAGE,zanka,15:45-16:00
8/3 Sun,SKY STAGE,さとりモンスター,16:00-16:15
8/3 Sun,SKY STAGE,なみだ色の消しごむ,16:15-16:30
8/3 Sun,SKY STAGE,シャニムニ=パレード,16:35-16:50
8/3 Sun,SKY STAGE,ANA®KIE,16:50-17:05
8/3 Sun,SKY STAGE,ドレスコード,17:05-17:20
8/3 Sun,SKY STAGE,ideal peco,17:20-17:35
8/3 Sun,SKY STAGE,AsIs,17:40-17:55
8/3 Sun,SKY STAGE,amini,17:55-18:10
8/3 Sun,SKY STAGE,キングサリ,18:10-18:25
8/3 Sun,SKY STAGE,Maison de Queen,18:25-18:40
8/3 Sun,SKY STAGE,LinQ,18:45-19:00
8/3 Sun,SKY STAGE,衛星とカラテア,19:00-19:15
8/3 Sun,SKY STAGE,ドラマチックレコード,19:15-19:30
`;

        // グローバル変数
        let app;
        let db;
        let auth;
        let userId = null;
        let fullTimetable = [];
        let myTimetable = {}; // { eventId: eventObject } の形式で管理
        let searchQuery = '';
        let selectedDate = null; // 全体タイムテーブル用
        let myTimetableFilterDate = 'all'; // マイタイムテーブル用: 'all'または特定の日付文字列
        let uniqueDates = [];

        // DOM要素の参照
        const userIdDisplay = document.getElementById('user-id-display');
        const currentUserIdSpan = document.getElementById('current-user-id');
        const firestoreLoadingIndicator = document.getElementById('firestore-loading-indicator');
        const myTimetableContent = document.getElementById('my-timetable-content');
        const myTimetableDateFilterContainer = document.getElementById('my-timetable-date-filter'); // 新しい要素
        const searchInput = document.getElementById('search-input');
        const clearSearchButton = document.getElementById('clear-search-button');
        const dateSelectionButtonsContainer = document.getElementById('date-selection-buttons');
        const fullTimetableContent = document.getElementById('full-timetable-content');
        const appRoot = document.getElementById('app-root'); // エラー表示用

        // スケジュールコード管理用のDOM要素
        const scheduleCodeInput = document.getElementById('schedule-code-input');
        const generateCodeBtn = document.getElementById('generate-code-btn');
        const saveScheduleBtn = document.getElementById('save-schedule-btn');
        const loadScheduleBtn = document.getElementById('load-schedule-btn');
        const codeManagementMessage = document.getElementById('code-management-message');

        // メッセージボックス表示関数
        function showMessage(message, isError = false) {
            codeManagementMessage.textContent = message;
            codeManagementMessage.classList.remove('text-green-600', 'text-red-600', 'text-gray-600');
            if (isError) {
                codeManagementMessage.classList.add('text-red-600');
            } else {
                codeManagementMessage.classList.add('text-green-600');
            }
            // 3秒後にメッセージをクリア
            setTimeout(() => {
                codeManagementMessage.textContent = '';
                codeManagementMessage.classList.remove('text-green-600', 'text-red-600');
            }, 3000);
        }

        // エラー表示関数 (アプリ全体のエラー用)
        function displayError(message, errorObject = null) {
            let errorMessage = message;
            if (errorObject) {
                console.error("アプリケーションエラーの詳細:", errorObject);
                if (errorObject.code === 'auth/configuration-not-found') {
                    errorMessage += `<br><br><span class="text-sm font-normal">
                        Firebase認証の設定が見つかりません。
                        <br>Firebaseプロジェクトのコンソールにアクセスし、
                        <br>「Authentication」セクションで「匿名」プロバイダが有効になっていることを確認してください。
                        <br>また、プロジェクト設定の「全般」タブでウェブアプリの設定が正しいか確認してください。
                    </span>`;
                } else {
                    errorMessage += `<br><span class="text-sm font-normal">詳細: ${errorObject.message || '不明なエラー'}</span>`;
                }
            }

            appRoot.innerHTML = `
                <div class="flex flex-col items-center justify-center min-h-screen bg-red-600 text-white p-4 rounded-lg shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x-circle mb-4"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                    <h2 class="text-2xl font-bold mb-2">エラーが発生しました</h2>
                    <p class="text-lg text-center">${errorMessage}</p>
                    <p class="text-sm mt-4">ブラウザのデベロッパーコンソールで詳細を確認してください。</p>
                    <p class="text-sm">ページを再読み込みするか、後でもう一度お試しください。</p>
                </div>
            `;
        }

        // CSVデータをパースしてオブジェクトの配列に変換するヘルパー関数
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',');
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const item = {};
                headers.forEach((header, i) => {
                    item[header.trim()] = values[i].trim();
                });
                // 各イベントにユニークなIDを付与 (FirestoreドキュメントIDとして使用)
                item.id = `${item.Date}-${item.Stage}-${item.Performer}-${item.Time}`.replace(/[^a-zA-Z0-9-]/g, '');
                return item;
            });
        }

        // 日付に応じたテーマカラーを返すヘルパー関数
        function getDateColors(date) {
            const day = date.split(' ')[0]; // "8/1", "8/2", "8/3"
            switch (day) {
                case '8/1': // ピンク系
                    return {
                        headerBg: 'bg-pink-100',
                        headerText: 'text-pink-800',
                        headerBorder: 'border-pink-200',
                        buttonActiveBg: 'bg-pink-600',
                        buttonActiveText: 'text-white',
                        buttonHoverBg: 'hover:bg-pink-300',
                        buttonHoverText: 'hover:text-pink-800',
                        buttonDefaultBg: 'bg-pink-200',
                        buttonDefaultText: 'text-pink-700',
                        iconColor: 'text-pink-500'
                    };
                case '8/2': // 水色系
                    return {
                        headerBg: 'bg-blue-100',
                        headerText: 'text-blue-800',
                        headerBorder: 'border-blue-200',
                        buttonActiveBg: 'bg-blue-600',
                        buttonActiveText: 'text-white',
                        buttonHoverBg: 'hover:bg-blue-300',
                        buttonHoverText: 'hover:text-blue-800',
                        buttonDefaultBg: 'bg-blue-200',
                        buttonDefaultText: 'text-blue-700',
                        iconColor: 'text-blue-500'
                    };
                case '8/3': // 黄緑系
                    return {
                        headerBg: 'bg-lime-100',
                        headerText: 'text-lime-800',
                        headerBorder: 'border-lime-200',
                        buttonActiveBg: 'bg-lime-600',
                        buttonActiveText: 'text-white',
                        buttonHoverBg: 'hover:bg-lime-300',
                        buttonHoverText: 'hover:text-lime-800',
                        buttonDefaultBg: 'bg-lime-200',
                        buttonDefaultText: 'text-lime-700',
                        iconColor: 'text-lime-500'
                    };
                default: // デフォルト（予期せぬ日付の場合）
                    return {
                        headerBg: 'bg-gray-100',
                        headerText: 'text-gray-800',
                        headerBorder: 'border-gray-200',
                        buttonActiveBg: 'bg-indigo-600',
                        buttonActiveText: 'text-white',
                        buttonHoverBg: 'hover:bg-gray-300',
                        buttonHoverText: 'hover:text-gray-800',
                        buttonDefaultBg: 'bg-gray-200',
                        buttonDefaultText: 'text-gray-700',
                        iconColor: 'text-gray-500'
                    };
            }
        }

        // ステージに応じたテーマカラーを返すヘルパー関数
        function getStageColors(stageName) {
            switch (stageName) {
                case 'UP-T HOT STAGE':
                    return {
                        bg: 'bg-red-50',
                        text: 'text-red-800',
                        border: 'border-red-200',
                        icon: 'text-red-500'
                    };
                case 'HEAT GARAGE':
                    return {
                        bg: 'bg-orange-50',
                        text: 'text-orange-800',
                        border: 'border-orange-200',
                        icon: 'text-orange-500'
                    };
                case 'SMILE GARDEN':
                    return {
                        bg: 'bg-green-50',
                        text: 'text-green-800',
                        border: 'border-green-200',
                        icon: 'text-green-500'
                    };
                case 'DOLL FACTORY':
                    return {
                        bg: 'bg-purple-50',
                        text: 'text-purple-800',
                        border: 'border-purple-200',
                        icon: 'text-purple-500'
                    };
                case 'SKY STAGE':
                    return {
                        bg: 'bg-cyan-50',
                        text: 'text-cyan-800',
                        border: 'border-cyan-200',
                        icon: 'text-cyan-500'
                    };
                case 'TOROCCO PARK':
                    return {
                        bg: 'bg-yellow-50',
                        text: 'text-yellow-800',
                        border: 'border-yellow-200',
                        icon: 'text-yellow-500'
                    };
                case '浮島STAGE':
                    return {
                        bg: 'bg-fuchsia-50',
                        text: 'text-fuchsia-800',
                        border: 'border-fuchsia-200',
                        icon: 'text-fuchsia-500'
                    };
                default:
                    return { // Default fallback
                        bg: 'bg-gray-50',
                        text: 'text-gray-800',
                        border: 'border-gray-200',
                        icon: 'text-gray-500'
                    };
            }
        }

        // アーティスト名の表示を切り替える関数
        window.togglePerformerName = function(element) {
            const shortNameSpan = element.querySelector('.short-name');
            const fullNameSpan = element.querySelector('.full-name');
            const toggleIndicatorSpan = element.querySelector('.toggle-indicator');

            if (shortNameSpan && fullNameSpan && toggleIndicatorSpan) {
                if (fullNameSpan.classList.contains('hidden')) {
                    shortNameSpan.classList.add('hidden');
                    fullNameSpan.classList.remove('hidden');
                    toggleIndicatorSpan.textContent = ' (閉じる)';
                } else {
                    shortNameSpan.classList.remove('hidden');
                    fullNameSpan.classList.add('hidden');
                    toggleIndicatorSpan.textContent = '...';
                }
            }
        };

        // アーティスト名を表示するヘルパー関数
        function getPerformerNameHtml(performerName, colors) {
            const maxLength = 15; // 15文字以上で折りたたむ
            if (performerName.length > maxLength) {
                const shortName = performerName.substring(0, maxLength);
                return `
                    <p class="font-semibold ${colors.text} cursor-pointer" onclick="togglePerformerName(this)">
                        <span class="short-name">${shortName}</span>
                        <span class="full-name hidden">${performerName}</span>
                        <span class="toggle-indicator text-blue-500 text-xs ml-1">...</span>
                    </p>
                `;
            } else {
                return `<p class="font-semibold ${colors.text}">${performerName}</p>`;
            }
        }

        // マイタイムテーブルのレンダリング
        function renderMyTimetable() {
            // myTimetableオブジェクトの値を配列に変換
            let filteredEvents = Object.values(myTimetable);

            // myTimetableFilterDateに基づいてフィルタリング
            if (myTimetableFilterDate !== 'all') {
                filteredEvents = filteredEvents.filter(event => event.Date === myTimetableFilterDate);
            }

            // フィルタリングされたイベントを日付と時間でソート
            const sortedMyTimetableEvents = filteredEvents.sort((a, b) => {
                const dateA = new Date(a.Date.replace(/(\d+)\/(\d+)\s(\w+)/, `2025/$1/$2`));
                const dateB = new Date(b.Date.replace(/(\d+)\/(\d+)\s(\w+)/, `2025/$1/$2`));
                if (dateA - dateB !== 0) {
                    return dateA - dateB;
                }
                const timeA = parseInt(a.Time.split('-')[0].replace(':', ''));
                const timeB = parseInt(b.Time.split('-')[0].replace(':', ''));
                return timeA - timeB;
            });

            if (sortedMyTimetableEvents.length === 0) {
                myTimetableContent.innerHTML = `
                    <p class="text-lg text-gray-600 text-center py-8">
                        ${myTimetableFilterDate === 'all' ? 'まだイベントが追加されていません。下のリストから追加してください！' : `選択された日付 (${myTimetableFilterDate}) にはイベントがありません。`}
                    </p>
                `;
                return;
            }

            const groupedMyTimetable = sortedMyTimetableEvents.reduce((acc, event) => {
                if (!acc[event.Date]) acc[event.Date] = [];
                acc[event.Date].push(event);
                return acc;
            }, {});

            let html = '<div class="grid grid-cols-1 md:grid-cols-2 gap-4">';
            for (const date in groupedMyTimetable) {
                const events = groupedMyTimetable[date];
                const dateColors = getDateColors(date); // 日付のテーマカラーを取得
                html += `
                    <div class="${dateColors.headerBg} rounded-lg p-4 shadow-md border ${dateColors.headerBorder}">
                        <h3 class="text-xl font-semibold mb-3 ${dateColors.headerText} flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-2 ${dateColors.iconColor}"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                            ${date}
                        </h3>
                        <ul class="space-y-2">
                `;
                events.forEach(event => {
                    const stageColors = getStageColors(event.Stage); // ステージのカラーを取得
                    html += `
                            <li class="flex items-center justify-between ${stageColors.bg} p-3 rounded-lg shadow-sm border ${stageColors.border}">
                                <div>
                                    ${getPerformerNameHtml(event.Performer, stageColors)}
                                    <p class="text-sm ${stageColors.text} flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock mr-1 text-gray-500"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                        ${event.Time} @ ${event.Stage}
                                    </p>
                                </div>
                                <button
                                    data-event-id="${event.id}"
                                    class="toggle-my-timetable-btn p-2 bg-red-500 hover:bg-red-600 text-white rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400"
                                    aria-label="${event.Performer}をマイタイムテーブルから削除"
                                >
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-minus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>
                                </button>
                            </li>
                    `;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            html += '</div>';
            myTimetableContent.innerHTML = html;
        }

        // 全タイムテーブルのレンダリング
        function renderFullTimetable() {
            if (!selectedDate) {
                fullTimetableContent.innerHTML = `
                    <p class="text-lg text-gray-600 text-center py-8">
                        日付を選択してください。
                    </p>
                `;
                return;
            }

            const filteredBySearch = fullTimetable.filter(event =>
                event.Performer.toLowerCase().includes(searchQuery.toLowerCase())
            );

            const groupedByDateAndStage = filteredBySearch.reduce((acc, event) => {
                if (!acc[event.Date]) {
                    acc[event.Date] = {};
                }
                if (!acc[event.Date][event.Stage]) {
                    acc[event.Date][event.Stage] = [];
                }
                acc[event.Date][event.Stage].push(event);
                return acc;
            }, {});

            const currentDayTimetable = groupedByDateAndStage[selectedDate];

            if (!currentDayTimetable || Object.keys(currentDayTimetable).length === 0) {
                fullTimetableContent.innerHTML = `
                    <p class="text-lg text-gray-600 text-center py-8">
                        ${searchQuery ? `「${searchQuery}」に一致するアーティストは、選択された日付には見つかりませんでした。` : '選択された日付のタイムテーブルが見つかりません。'}
                    </p>
                `;
                return;
            }

            const dateColors = getDateColors(selectedDate); // 日付のテーマカラーを取得
            let html = `
                <div class="mb-8 last:mb-0">
                    <h3 class="text-2xl font-bold mb-4 ${dateColors.headerText} ${dateColors.headerBg} p-3 rounded-lg shadow-md flex items-center border ${dateColors.headerBorder}">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-calendar-days mr-2 ${dateColors.iconColor}"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                        ${selectedDate}
                    </h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6">
            `;

            for (const stageName in currentDayTimetable) {
                const events = currentDayTimetable[stageName];
                const stageColors = getStageColors(stageName); // ステージのカラーを取得
                html += `
                    <div class="${stageColors.bg} rounded-xl p-4 shadow-lg border ${stageColors.border}">
                        <h4 class="text-xl font-semibold mb-4 ${stageColors.text} flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-users mr-2 ${stageColors.icon}"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            ${stageName}
                        </h4>
                        <ul class="space-y-3">
                `;
                events.forEach(event => {
                    const isAdded = myTimetable[event.id];
                    html += `
                            <li class="${stageColors.bg} p-3 rounded-lg shadow-sm border ${stageColors.border} flex items-center justify-between">
                                <div>
                                    ${getPerformerNameHtml(event.Performer, stageColors)}
                                    <p class="text-sm ${stageColors.text} flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clock mr-1 text-gray-500"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                        ${event.Time}
                                    </p>
                                </div>
                                <button
                                    data-event-id="${event.id}"
                                    class="toggle-my-timetable-btn p-2 rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 ${
                                        isAdded
                                            ? 'bg-red-500 hover:bg-red-600 text-white focus:ring-red-400'
                                            : 'bg-green-500 hover:bg-green-600 text-white focus:ring-green-400'
                                    }"
                                    aria-label="${isAdded ? `${event.Performer}をマイタイムテーブルから削除` : `${event.Performer}をマイタイムテーブルに追加`}"
                                >
                                    ${isAdded
                                        ? '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check-circle"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>'
                                        : '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-plus-circle"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg>'
                                    }
                                </button>
                            </li>
                    `;
                });
                html += `
                        </ul>
                    </div>
                `;
            }
            html += '</div></div>';
            fullTimetableContent.innerHTML = html;
        }

        // マイタイムテーブルへの追加/削除関数
        async function toggleMyTimetable(eventData) {
            if (!db || !userId) {
                console.error("FirestoreまたはユーザーIDが利用できません。");
                showMessage("認証が完了していません。しばらくお待ちください。", true);
                return;
            }

            const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
            const eventDocRef = doc(db, `artifacts/${appId}/users/${userId}/myTimetable`, eventData.id);

            try {
                if (myTimetable[eventData.id]) {
                    // 既に存在する場合は削除
                    await deleteDoc(eventDocRef);
                    delete myTimetable[eventData.id]; // myTimetableオブジェクトからも削除
                    console.log(`イベントを削除しました: ${eventData.Performer}`);
                    showMessage(`${eventData.Performer} をマイタイムテーブルから削除しました。`);
                } else {
                    // 存在しない場合は追加
                    await setDoc(eventDocRef, eventData);
                    myTimetable[eventData.id] = eventData; // myTimetableオブジェクトに追加
                    console.log(`イベントを追加しました: ${eventData.Performer}`);
                    showMessage(`${eventData.Performer} をマイタイムテーブルに追加しました。`);
                }
                renderMyTimetable(); // マイタイムテーブルを再レンダリング
                renderFullTimetable(); // 全タイムテーブルも更新（追加/削除ボタンの状態反映）
            } catch (e) {
                console.error("マイタイムテーブルの更新エラー:", e);
                showMessage("タイムテーブルの更新中にエラーが発生しました。", true);
            }
        }

        // ランダムな4桁のコードを生成
        function generateRandomCode() {
            return Math.floor(1000 + Math.random() * 9000).toString(); // 1000から9999までの4桁
        }

        // ボタンのローディング状態を管理するヘルパー関数
        function setLoadingState(button, isLoading) {
            if (isLoading) {
                button.disabled = true;
                button.classList.add('opacity-50', 'cursor-not-allowed');
                // スピナーアイコンを追加
                if (!button.querySelector('.loader-spinner')) {
                    const spinner = document.createElement('span');
                    spinner.classList.add('loader-spinner', 'animate-spin', 'ml-2');
                    spinner.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-loader-2"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>';
                    button.appendChild(spinner);
                }
            } else {
                button.disabled = false;
                button.classList.remove('opacity-50', 'cursor-not-allowed');
                // スピナーアイコンを削除
                const spinner = button.querySelector('.loader-spinner');
                if (spinner) {
                    spinner.remove();
                }
            }
        }

        // スケジュールをコードで保存
        saveScheduleBtn.addEventListener('click', async () => {
            const code = scheduleCodeInput.value.trim();
            if (code.length !== 4) {
                codeManagementMessage.textContent = '4桁のコードを入力してください。';
                return;
            }
        
            const scheduleData = {
                message: 'ここにスケジュールのデータを格納します',
                timestamp: Date.now()
            };
        
            try {
                await db.collection("schedules").doc(code).set(scheduleData);
                codeManagementMessage.textContent = `コード「${code}」で保存しました（Firebase）。`;
            } catch (e) {
                console.error("保存エラー:", e);
                codeManagementMessage.textContent = '保存に失敗しました。';
            }
        });


        // スケジュールをコードで読み込む
        loadScheduleBtn.addEventListener('click', async () => {
            const code = scheduleCodeInput.value.trim();
            if (code.length !== 4) {
                codeManagementMessage.textContent = '4桁のコードを入力してください。';
                return;
            }

            try {
                const doc = await db.collection("schedules").doc(code).get();
                if (!doc.exists) {
                codeManagementMessage.textContent = `コード「${code}」のデータは存在しません。`;
                return;
            }

            const data = doc.data();
            console.log("読み込んだデータ:", data);
            codeManagementMessage.textContent = `コード「${code}」のデータを読み込みました（Consoleに表示）。`;
        } catch (e) {
            console.error("読み込みエラー:", e);
            codeManagementMessage.textContent = '読み込みに失敗しました。';
        }
    });



        // イベントリスナーの設定
        function setupEventListeners() {
            // 検索入力のイベントリスナー
            searchInput.addEventListener('input', () => {
                searchQuery = searchInput.value;
                if (searchQuery) {
                    clearSearchButton.classList.remove('hidden');
                } else {
                    clearSearchButton.classList.add('hidden');
                }
                renderFullTimetable();
            });

            // 検索クリアボタンのイベントリスナー
            clearSearchButton.addEventListener('click', () => {
                searchInput.value = '';
                searchQuery = '';
                clearSearchButton.classList.add('hidden');
                renderFullTimetable();
            });

            // 全体タイムテーブルの日付選択ボタンのイベントリスナー (イベント委譲)
            dateSelectionButtonsContainer.addEventListener('click', (event) => {
                if (event.target.tagName === 'BUTTON') {
                    const date = event.target.textContent.trim();
                    selectedDate = date; // selectedDate を更新
                    renderDateButtons(); // ボタンのスタイルを更新
                    renderFullTimetable(); // 選択された日付のタイムテーブルを再レンダリング
                }
            });

            // マイタイムテーブルの日付フィルターボタンのイベントリスナー (イベント委譲)
            myTimetableDateFilterContainer.addEventListener('click', (event) => {
                if (event.target.tagName === 'BUTTON' && event.target.dataset.date) {
                    myTimetableFilterDate = event.target.dataset.date;
                    renderMyTimetableFilterButtons(); // ボタンのスタイルを更新
                    renderMyTimetable(); // マイタイムテーブルを新しいフィルターで再レンダリング
                }
            });

            // マイタイムテーブル追加/削除ボタンのイベントリスナー (イベント委譲)
            document.addEventListener('click', async (event) => {
                if (event.target.closest('.toggle-my-timetable-btn')) {
                    const button = event.target.closest('.toggle-my-timetable-btn');
                    const eventId = button.dataset.eventId;
                    const eventData = fullTimetable.find(e => e.id === eventId);
                    if (eventData) {
                        await toggleMyTimetable(eventData);
                    }
                }
            });

            // スケジュールコード管理ボタンのイベントリスナー
            generateCodeBtn.addEventListener('click', () => {
                scheduleCodeInput.value = generateRandomCode();
                showMessage("新しいコードを生成しました。");
            });

            saveScheduleBtn.addEventListener('click', saveScheduleWithCode);
            loadScheduleBtn.addEventListener('click', loadScheduleWithCode);
        }

        // 全体タイムテーブルの日付選択ボタンのレンダリング
        function renderDateButtons() {
            dateSelectionButtonsContainer.innerHTML = ''; // 既存のボタンをクリア
            uniqueDates.forEach(date => {
                const button = document.createElement('button');
                button.textContent = date;
                const dateColors = getDateColors(date); // 日付のテーマカラーを取得
                button.classList.add(
                    'px-4', 'py-2', 'rounded-full', 'text-sm', 'font-semibold', // サイズを小さく調整
                    'transition-all', 'duration-300', 'ease-in-out', 'shadow-md',
                    dateColors.buttonDefaultBg, dateColors.buttonDefaultText,
                    dateColors.buttonHoverBg, dateColors.buttonHoverText
                );
                if (selectedDate === date) {
                    button.classList.add(dateColors.buttonActiveBg, dateColors.buttonActiveText, 'transform', 'scale-105', 'shadow-xl');
                    button.classList.remove(dateColors.buttonDefaultBg, dateColors.buttonDefaultText);
                } else {
                    button.classList.remove(dateColors.buttonActiveBg, dateColors.buttonActiveText, 'transform', 'scale-105', 'shadow-xl');
                }
                dateSelectionButtonsContainer.appendChild(button);
            });
        }

        // マイタイムテーブルの日付フィルターボタンのレンダリング
        function renderMyTimetableFilterButtons() {
            myTimetableDateFilterContainer.innerHTML = ''; // 既存のボタンをクリア

            const defaultDateColors = getDateColors('default'); // デフォルトカラーテーマを取得

            // 「すべて」ボタン
            const allButton = document.createElement('button');
            allButton.textContent = 'すべて';
            allButton.dataset.date = 'all';
            allButton.classList.add(
                'px-3', 'py-1.5', 'rounded-full', 'text-xs', 'font-semibold', // サイズを小さく調整
                'transition-all', 'duration-300', 'ease-in-out', 'shadow-sm',
                defaultDateColors.buttonDefaultBg, defaultDateColors.buttonDefaultText,
                defaultDateColors.buttonHoverBg, defaultDateColors.buttonHoverText
            );
            if (myTimetableFilterDate === 'all') {
                allButton.classList.add(defaultDateColors.buttonActiveBg, defaultDateColors.buttonActiveText, 'transform', 'scale-105');
                allButton.classList.remove(defaultDateColors.buttonDefaultBg, defaultDateColors.buttonDefaultText);
            } else {
                allButton.classList.remove(defaultDateColors.buttonActiveBg, defaultDateColors.buttonActiveText, 'transform', 'scale-105');
            }
            myTimetableDateFilterContainer.appendChild(allButton);

            // 個別の日付ボタン
            uniqueDates.forEach(date => {
                const button = document.createElement('button');
                button.textContent = date;
                button.dataset.date = date;
                const dateColors = getDateColors(date); // 日付のテーマカラーを取得
                button.classList.add(
                    'px-3', 'py-1.5', 'rounded-full', 'text-xs', 'font-semibold', // サイズを小さく調整
                    'transition-all', 'duration-300', 'ease-in-out', 'shadow-sm',
                    dateColors.buttonDefaultBg, dateColors.buttonDefaultText,
                    dateColors.buttonHoverBg, dateColors.buttonHoverText
                );
                if (myTimetableFilterDate === date) {
                    button.classList.add(dateColors.buttonActiveBg, dateColors.buttonActiveText, 'transform', 'scale-105');
                    button.classList.remove(dateColors.buttonDefaultBg, dateColors.buttonDefaultText);
                } else {
                    button.classList.remove(dateColors.buttonActiveBg, dateColors.buttonActiveText, 'transform', 'scale-105');
                }
                myTimetableDateFilterContainer.appendChild(button);
            });
        }

        // アプリケーションの初期化
        async function initApp() {
            try {
                // Firebase設定の取得
                // Canvas環境で__firebase_configが定義されていない場合に備えて、
                // グローバルスコープの__firebase_configを使用します。
                const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                let firebaseConfig = {};
                try {
                    // __firebase_configは文字列として提供されるため、JSON.parseでオブジェクトに変換
                    firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
                } catch (parseError) {
                    console.error("Firebase設定のパースエラー:", parseError);
                    displayError("Firebase設定の読み込み中にエラーが発生しました。設定が不正なJSON形式である可能性があります。", parseError);
                    return; // パースエラーの場合はここで処理を中断
                }

                // projectId と apiKey の存在チェック
                if (!firebaseConfig.projectId) {
                    console.warn("Firebase設定に 'projectId' が見つかりません。");
                    displayError("Firebase設定に 'projectId' が見つかりません。Canvas環境のFirebase設定が正しく構成されているか確認してください。", new Error("projectId not found in firebaseConfig"));
                    return; // projectId がない場合はここで処理を中断
                }
                if (!firebaseConfig.apiKey) {
                    console.warn("Firebase設定に 'apiKey' が見つかりません。");
                    displayError("Firebase設定に 'apiKey' が見つかりません。Canvas環境のFirebase設定が正しく構成されているか確認してください。", new Error("apiKey not found in firebaseConfig"));
                    return; // apiKey がない場合はここで処理を中断
                }


                // Firebaseの初期化
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // 認証状態の監視
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        try {
                            // __initial_auth_tokenが定義されている場合はカスタムトークンでサインイン
                            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token !== '') {
                                await signInWithCustomToken(auth, __initial_auth_token);
                            } else {
                                // それ以外の場合は匿名でサインイン
                                await signInAnonymously(auth);
                            }
                            userId = auth.currentUser?.uid || crypto.randomUUID();
                        } catch (e) {
                            console.error("認証エラー:", e);
                            displayError("認証に失敗しました。", e); // エラーオブジェクトを渡す
                            userId = crypto.randomUUID(); // エラー時も一時的なIDを生成
                        }
                    }
                    // ユーザーIDの表示 (今回は非表示にするため、この部分のコードはコメントアウトまたは削除)
                    // if (userId) {
                    //     currentUserIdSpan.textContent = userId;
                    //     userIdDisplay.classList.remove('hidden');
                    // }

                    // CSVデータのパース
                    fullTimetable = parseCSV(TIF_TIMETABLE_CSV);

                    // ユニークな日付の取得とソート
                    uniqueDates = [...new Set(fullTimetable.map(event => event.Date))].sort();
                    if (uniqueDates.length > 0) {
                        selectedDate = uniqueDates[0]; // 最初のユニークな日付を全体タイムテーブルの初期選択に
                        myTimetableFilterDate = 'all'; // マイタイムテーブルの初期フィルターは「すべて」
                    }

                    // Firestoreからのマイタイムテーブル購読
                    const myTimetableCollectionRef = collection(db, `artifacts/${appId}/users/${userId}/myTimetable`);
                    onSnapshot(myTimetableCollectionRef, (snapshot) => {
                        firestoreLoadingIndicator.classList.add('hidden'); // ローディングインジケーターを非表示に
                        myTimetable = {}; // リセット
                        snapshot.forEach((doc) => {
                            myTimetable[doc.id] = doc.data(); // ドキュメントのデータを直接保存
                        });
                        renderMyTimetableFilterButtons(); // マイタイムテーブルのフィルターボタンを再レンダリング
                        renderMyTimetable(); // マイタイムテーブルを再レンダリング
                        renderFullTimetable(); // 全タイムテーブルも更新（追加/削除ボタンの状態反映）
                    }, (err) => {
                        console.error("Firestoreからのデータ取得エラー:", err);
                        displayError("マイタイムテーブルの読み込み中にエラーが発生しました。", err); // エラーオブジェクトを渡す
                        firestoreLoadingIndicator.classList.add('hidden');
                    });

                    // 初回レンダリング
                    renderDateButtons(); // 全体タイムテーブルの日付ボタン
                    renderFullTimetable(); // 全体タイムテーブル
                    // renderMyTimetableFilterButtonsとrenderMyTimetableはonSnapshot内で呼ばれるため、ここでは不要
                });

                // イベントリスナーの設定
                setupEventListeners();

            } catch (e) {
                console.error("アプリケーション初期化エラー:", e); // エラーをコンソールに出力
                displayError("アプリケーションの初期化中に致命的なエラーが発生しました。", e); // エラーオブジェクトを渡す
            }
        }

        // DOMが完全にロードされた後にアプリを初期化
        window.onload = initApp;
    </script>
</body>
</html>
